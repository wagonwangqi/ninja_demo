<#include "/mag/gaia/staff/views/layout/staff_layout.ftl.html" />
<#macro title>StaffDashbard</#macro>
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <script>
    let jsonStr =null;
    $(document).ready(function(){
      $.ajax({
        url:"/getCourseList",
        type:"POST",
        data:{
        },
        success:function (data) {
          console.log(data);
          jsonStr=data;
          let bigCategoryName =document.getElementById("bigCategory");
          for(let index in jsonStr.courseList){
            let option = document.createElement("option");
            option.innerHTML=jsonStr.courseList[index].couName;
            option.value=jsonStr.courseList[index].couId;

            bigCategoryName.appendChild(option);
          }
        },
        error:function () {
          console.log("failed");

        }
      });
    });

    function showSmallCategory(options) {
      let selectedIndex=options.selectedIndex;
      if(selectedIndex>0){
        let smallCategories=jsonStr.courseList[selectedIndex-1].chapters;
        let smallCategoryOptions=document.getElementById("smallCategory");
        smallCategoryOptions.innerHTML="<option>选择章目</option>"
        for (let index in smallCategories){
          let option =document.createElement("option");
          option.innerHTML=smallCategories[index].chapterName;
          option.value=smallCategories[index].id;
          smallCategoryOptions.appendChild(option);
        }
      }
    }


    $("#smallCategory").change(function () {
      let small =parseInt($(this).val()) ;
      let big =parseInt($("#bigCategory").val()) ;
      let sectionss ="";
      $("#tbody-result").find("tr").remove();
      let tbody=window.document.getElementById("tbody-result");
        for (let i = 0; i < jsonStr.courseList.length; i++) {
            for (let j = 0; j < jsonStr.courseList[i].chapters.length; j++) {
                if ( big==jsonStr.courseList[i].couId && small==jsonStr.courseList[i].chapters[j].id
                ){
             sectionss = jsonStr.courseList[i].chapters[j];
            }
        }
        }

        console.log("sec"+sectionss);
        let jsons=sectionss.sections;
        let str="";
        for(let i in jsons){
            str+="<tr>"+
                "<td>"+jsons[i].id+"</td>"+
                "<td>"+jsons[i].sectionName+"</td>"+
                "<td>"+"<a href='/staff/editSectionName/"+jsons[i].id+"/${session.id}'>编辑</a>"+"</td>"+
                "<td>"+"<a href='/staff/editVideo/"+jsons[i].id+"/${session.id}'>编辑</a>"+"</td>"+
                    "<td>"+"<a href='/staff/deleteSection/"+jsons[i].id+"/${session.id}'>删除</a>"+"</td>"+
                "</tr>";
        }
        tbody.innerHTML =str;


      // $.ajax({
      //   async: false,
      //   url: "/staff/getSection/"+${session.id}+"",
      //   type: "POST",
      //   data: {
      //     "courseId": big,
      //     "chapterId":small
      //   },
      //   success: function (data) {
      //     console.log(data);
      //     let jsons=data.sectionList;
      //     let str="";
      //     for(let i in jsons){
      //       str+="<tr>"+
      //               "<td>"+jsons[i].id+"</td>"+
      //               "<td>"+jsons[i].sectionName+"</td>"+
      //               "<td>"+"<a href='/staff/editChapterName/"+jsons[i].id+"/${session.id}'>edit</a>"+"</td>"+
      //               "<td>"+"<a href='/staff/editSection/"+jsons[i].id+"/${session.id}'>edit</a>"+"</td>"+
      //               "<td>"+"<a href='/staff/editHomework/"+jsons[i].id+"/${session.id}'>edit</a>"+"</td>"+
      //               "</tr>";
      //     }
      //     tbody.innerHTML =str;
      //   },
      //   error: function () {
      //     console.log("failed");
      //   }
      // });
    });
  </script>

</head>
<#macro body>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">MySec</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group me-2">
      <select id="bigCategory" name="bigCategory" onchange="showSmallCategory(this);">
        <option value="">选择课程</option>
      </select>
      <select id="smallCategory" name="smallCategory" >
        <option value="">选择章目</option>
      </select>
      <button type="button" class="btn btn-sm btn-outline-secondary"><a
              href="/staff/addSection/${session.id}">添加节次</a></button>
    </div>
  </div>
</div>
<div class="table-responsive">
  <table class="table table-striped table-sm"  id="table-result">
    <thead>
    <tr>
      <th>节次编号</th>
      <th>节次名称</th>
      <th>编辑节名</th>
      <th>编辑视频</th>
      <th>删除节次</th>
    </tr>
    </thead>
    <tbody  id="tbody-result">
    <#list sectionList as section>
    <tr>
      <td>${section.id}</td>
      <td>${section.sectionName}</td>
      <td><a href="/staff/editSectionName/${section.id}/${session.id}">编辑</a></td>
      <td><a href="/staff/editVideo/${section.id}/${session.id}">编辑</a></td>
      <td><a href="/staff/deleteSection/${section.id}/${session.id}">删除</a></td>
    </tr>
    </#list>
    </tbody>
  </table>
</div>

</#macro>


